name: Test OpenTelemetry Helm Chart

on:
  push:
    branches: [ main ]
    paths:
      - 'charts/opentelemetry-kube-stack/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'charts/opentelemetry-kube-stack/**'

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Helm
      uses: azure/setup-helm@v3
      with:
        version: '3.12.0'
    
    - name: Lint Helm chart
      run: |
        helm lint charts/opentelemetry-kube-stack

  unittest:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Helm
      uses: azure/setup-helm@v3
      with:
        version: '3.12.0'
    
    - name: Install Helm unittest plugin
      run: |
        helm plugin install https://github.com/quintush/helm-unittest
    
    - name: Run Helm unit tests
      run: |
        helm unittest charts/opentelemetry-kube-stack